<html>
  <head>
    <title id="title">RavenDB - Image Gallery Project (V) - The Structure</title>
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedblitz.com/robashton&x=1" title="Rob Ashton's blog" />
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a class="subscribe" href="http://feed.codeofrob.com/RobAshton">Subscribe to my blog</a>
    <div id="blog-entry">
      <h1 id="post-title">RavenDB - Image Gallery Project (V) - The Structure</h1>
      <h6>Published on <span class="date">2010-10-1</span></h6>
      <div id="post">
		<p>The code for this and all other entries can be found here: <a href="http://github.com/robashton/RavenGallery/">http://github.com/robashton/RavenGallery/</a>&nbsp;</p>  <p>Disclaimer: The structure of this application will be as simple as I can get it whilst still maintaining some semblance of maintainability going forward, any complaints can be directed at the comments field below if you think I’m committing some heinous crimes with the contents of this entry. The beauty of writing code with a high separation of concerns is that any of this can change without too much fuss if the initial code proves unworthy. This is all largely irrelevant anyway, but as the following entries will all utilise code using this structure, I thought it best to write an entry describing the basic principles of how the system works.</p>  <p><strong>Views vs Entities</strong></p>  <p>We have one data storage system, it stores documents and allows us to query those documents. Those documents are generally a lot flatter than those we have been used to in the past, and that allows us to store all the information required for a single entity in a single document (for the most part). A couple of assumptions therefore</p>  <ul>   <li>When dealing with behaviour or units of work, we’re dealing with entities and by therefore the underlying documents that represent those entities. </li>    <li>When dealing with pages of information, or views – we’re dealing with indexes across those documents, rather than complete documents themselves </li> </ul>  <p>It makes sense therefore to separate these two concerns into two different systems</p>  <p><strong>Views</strong></p>  <p>Without getting into the detail of how we get these views out yet, views are something we need. In our application here, a view is a single class containing all the information required to render a page of information. Generally, some information will be required to know what data is required for that view – that might just be an ID, or it might be the type of view and some information about how many items are to be displayed, some search terms to look for and a few other snippets beyond that.</p>  <p>We therefore have two types to be aware of, the input type containing information about the view we want, and the view itself.</p>  <p>I’m going to be brave and define an interface here, I can always change it later on it if proves unworthy of our love</p>  <div class="csharpcode">   <pre class="alt"><span class="lnum">   1:  </span><span class="kwrd">public</span> <span class="kwrd">interface</span> IViewRepository</pre>

  <pre><span class="lnum">   2:  </span>{</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        TOutput Load&lt;TInput, TOutput&gt;(TInput input);</pre>

  <pre><span class="lnum">   4:  </span>}</pre>
</div>
<style type="text/css">![CDATA[














.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>

<p>&nbsp;</p>
And with that, an interface for our view factories to implement: 

<div class="csharpcode">
  <pre class="alt"><span class="lnum">   1:  </span><span class="kwrd">public</span> <span class="kwrd">interface</span> IViewFactory&lt;TInput, TOutput&gt;</pre>

  <pre><span class="lnum">   2:  </span>{</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        TOutput Load(TInput input);</pre>

  <pre><span class="lnum">   4:  </span>}</pre>
</div>
<style type="text/css">![CDATA[













.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>

<p>If a controller action takes in a TInput as a parameter, then it can go ahead, request the view and return that for delivery. We’ll talk more about how we’ll get hold of these views later, as there are numerous ways to go about it. They could be pre-computed manually, they could be composed by aggregating multiple documents together or they could come from somewhere else entirely; they are read only.</p>

<p><strong>Entities</strong></p>

<p>Here is where I might make a few enemies, I won’t count the documents themselves as my entities, documents are just how I talk to the data store, have getters/setters all over them and don’t contain any behaviour&nbsp; – I’ll be creating entities that wrap up the documents and provide behaviour around them. This will follow the pattern of</p>

<div class="csharpcode">
  <pre class="alt"><span class="lnum">   1:  </span>    <span class="kwrd">public</span> <span class="kwrd">class</span> WrappingEntity : IEntity&lt;WrappedDocument&gt;</pre>

  <pre><span class="lnum">   2:  </span>    {</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        <span class="kwrd">private</span> WrappedDocument innerDocument;</pre>

  <pre><span class="lnum">   4:  </span>&nbsp;</pre>

  <pre class="alt"><span class="lnum">   5:  </span>        <span class="kwrd">public</span> WrappingEntity(<span class="kwrd">string</span> someProperty, <span class="kwrd">string</span> someOtherProperty)</pre>

  <pre><span class="lnum">   6:  </span>        {</pre>

  <pre class="alt"><span class="lnum">   7:  </span>            innerDocument = <span class="kwrd">new</span> WrappedDocument()</pre>

  <pre><span class="lnum">   8:  </span>            {</pre>

  <pre class="alt"><span class="lnum">   9:  </span>                SomeProperty = someProperty,</pre>

  <pre><span class="lnum">  10:  </span>                SomeOtherProperty = someOtherProperty</pre>

  <pre class="alt"><span class="lnum">  11:  </span>            };</pre>

  <pre><span class="lnum">  12:  </span>        }</pre>

  <pre class="alt"><span class="lnum">  13:  </span>&nbsp;</pre>

  <pre><span class="lnum">  14:  </span>        <span class="kwrd">public</span> WrappingEntity(WrappedDocument innerDocument)</pre>

  <pre class="alt"><span class="lnum">  15:  </span>        {</pre>

  <pre><span class="lnum">  16:  </span>            innerDocument = innerDocument;</pre>

  <pre class="alt"><span class="lnum">  17:  </span>        }</pre>

  <pre><span class="lnum">  18:  </span>&nbsp;</pre>

  <pre class="alt"><span class="lnum">  19:  </span>        <span class="kwrd">private</span> WrappedDocument IEntity&lt;WrappedDocument&gt;.GetInnerDocument()</pre>

  <pre><span class="lnum">  20:  </span>        {</pre>

  <pre class="alt"><span class="lnum">  21:  </span>            <span class="kwrd">return</span> innerDocument;</pre>

  <pre><span class="lnum">  22:  </span>        }</pre>

  <pre class="alt"><span class="lnum">  23:  </span>&nbsp;</pre>

  <pre><span class="lnum">  24:  </span>        <span class="kwrd">public</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> PerformSomeAction()</pre>

  <pre class="alt"><span class="lnum">  25:  </span>        {</pre>

  <pre><span class="lnum">  26:  </span>&nbsp;</pre>

  <pre class="alt"><span class="lnum">  27:  </span>        }</pre>

  <pre><span class="lnum">  28:  </span>&nbsp;</pre>

  <pre class="alt"><span class="lnum">  29:  </span>        <span class="kwrd">public</span> <span class="kwrd">virtual</span> <span class="kwrd">void</span> PerformSomeOtherAction()</pre>

  <pre><span class="lnum">  30:  </span>        {</pre>

  <pre class="alt"><span class="lnum">  31:  </span>&nbsp;</pre>

  <pre><span class="lnum">  32:  </span>        }</pre>

  <pre class="alt"><span class="lnum">  33:  </span>    }</pre>
</div>
<style type="text/css">![CDATA[










.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>

<p>&nbsp;</p>

<p>Because we shouldn’t ever need to query for entities, the interface for getting/saving/deleting entities will be very simple and look something like this:</p>

<div class="csharpcode">
  <pre class="alt"><span class="lnum">   1:  </span>    <span class="kwrd">public</span> <span class="kwrd">interface</span> IEntityRepository&lt;TEntity, TDocument&gt; <span class="kwrd">where</span> TEntity : IEntity&lt;TDocument&gt;</pre>

  <pre><span class="lnum">   2:  </span>    {</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        TEntity Load(<span class="kwrd">string</span> id);</pre>

  <pre><span class="lnum">   4:  </span>        <span class="kwrd">void</span> Add(TEntity entity);</pre>

  <pre class="alt"><span class="lnum">   5:  </span>        <span class="kwrd">void</span> Remove(TEntity entity);</pre>

  <pre><span class="lnum">   6:  </span>    }</pre>
</div>

<ul>
  <li></li><style type="text/css">![CDATA[










.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>The repository will be responsible for loading a document by id and creating the appropriate entity type around that document, and saving/deleting entities by passing their inner documents to the IDocumentSession. The entities will be responsible for enacting change to those documents; they are <em>effectively</em> write-only.<style type="text/css">![CDATA[










.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style> 

  <li>Since our entities themselves aren’t about state and don’t contain state (they only enact change to the document themselves), subsequent calls to the repository for the same entity won’t result in any adverse side effects as they’ll be working on the same underlying document. </li>

  <li>We already have the necessary data to enact commands on the entity from the views, so there is generally no need to expose state through these entities, and it means that if we have to store additional data on the underlying document that doesn’t belong to this entity, our entity doesn’t suffer from this. </li>

  <li>We could have achieved the same by sticking our behaviour on the documents, but then we have to go through some hoop jumping to make sure the entity state remains valid, to create test data (if we make the state itself private) and to serialize/de-serialize the documents. </li>

  <li>This is a case of my experience with teams of developers who if they “can” do something the easy way, they “will”, there is nothing to stop you and nothing wrong with just having public gets/sets on your documents AND having behaviour on them – this is probably more appropriate for this kind of project anyway</li>
</ul>

<p>Note, on a simple project like this, there would probably be no problem with just using the documents directly and enacting change on them via separate “scripts” within a transaction – I choose to do this because I want to show I’d use RavenDB to solve a more complicated problem/project.</p>

<p><strong>Unit of work</strong></p>

<p>I mentioned in the previous entry that I was going to leave committing changes to the application itself, I’m going to assume that in our application we’ll be able to represent all of the changes required by a HTTP post action with a single class structure, and for ease of understanding we’ll call that a Command. For now we’ll go ahead with the understanding that we can fire off a command to a magical interface and that interface will take care of the unit of work.</p>

<div class="csharpcode">
  <pre class="alt"><span class="lnum">   1:  </span>    <span class="kwrd">public</span> <span class="kwrd">interface</span> ICommandInvoker</pre>

  <pre><span class="lnum">   2:  </span>    {</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        <span class="kwrd">void</span> Execute&lt;T&gt;(T command);</pre>

  <pre><span class="lnum">   4:  </span>    }</pre>
</div>
<style type="text/css">![CDATA[








.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>

<p>The command invoker will look for an appropriate handler (seen below) and pass the command to that for processing (most likely it will retrieve entities by ID and call methods on them)</p>

<div class="csharpcode">
  <pre class="alt"><span class="lnum">   1:  </span>    <span class="kwrd">public</span> <span class="kwrd">interface</span> ICommandHandler&lt;T&gt;</pre>

  <pre><span class="lnum">   2:  </span>    {</pre>

  <pre class="alt"><span class="lnum">   3:  </span>        <span class="kwrd">void</span> Handle(T command);</pre>

  <pre><span class="lnum">   4:  </span>    }</pre>
</div>
<style type="text/css">![CDATA[








.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style>

<p><span class="lnum"></span>The Command Invoker implementation will be responsible for finding the appropriate command handler to execute and calling SaveChanges at the end of this process, flushing any changes through to the underlying store.</p>

<p><strong>Implementation of the above</strong></p>

<p>The above all uses StructureMap magic to locate the appropriate handlers/view factories in much the same way we’ll be using StructureMap to find validators, model binders and other such niceties.</p>

<p>In the next instalment of this series, we’ll create our user document, our user entity and the necessary infrastructure required to create/retrieve user entities from the repository, as well as demonstrating the functionality of the ICommandInvoker that we’ll be using throughout this series.</p>
	</div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="inqob_job_postings"></div> 
      <script type="text/javascript" charset="utf-8">
        var __inqob_settings = {
          email_address:  'robashton@codeofrob.com', 
          token:          '',
          debug: false,
          items: [{
            keyword: 'codeofrob', 
            price: 100 
          }]
        };

        (function(is) {
          var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true;
          var src = (document.location.protocol == 'https:' ? 'https://' : 'http://') + 'inqob.com/get/script';
          var q = [];
          q.push('?t='+ new Date().getTime()); 
          q.push('token=' + is.token); 
          q.push('email_address=' + is.email_address); 
          q.push('href=' + encodeURIComponent(window.location.href));
          sc.src = src + q.join('&');
          var s = document.getElementsByTagName('script')[0]; 
          s.parentNode.insertBefore(sc, s);
        })(__inqob_settings);      
      </script>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments"><div class="comment">
<div class="comment-author">
<img src="/images/IdenticonHandler.ashx?code=1666950235"/>
<p>Doug</p></div>
<div class="comment-body">
<br/> 				Loving where this series is going.  Keep 'em coming!
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=7cd5b28ad1848b191e4e2649881fd28e&size=50&default=identicon"/>
<p>Chris Swain</p></div>
<div class="comment-body">
<br/> 				I'm so glad you're doing this blog series.  It's going to be helpful to those of us looking for guidance with RavenDB and ASP.NET MVC.  I downloaded the sample project and I'm not sure why you have documents, entities, and viewmodels.  Could you explain a little more about the difference between your entities and your viewmodels and why you need both?
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				Ah - well that is definitely a non-contentious question :)I don't *need* those things, and I could just return the documents and use those as my view models, but I'm doing this project as not just a RavenDB primer but as an example of how CQRS can work well with a single data store when that data store is a document database with pre-computed map/reduce indexes.As a purist, this means entities shouldn't really be used for the view layer (querying).The "Should I use my entities on my view model" question has been done to death in the DDD threads/forums/etc - and for simple projects like this you probably wouldn't have any issues with doing so - but architecturally it doesn't scale (and in RDBMS projects you can swiftly end up with Select N+1 problems as you try to traverse through the relationships of the entity). You could still end up with that in this kind of project if you were not careful too.Even if I merged Entities and Documents, I'd still not be using the Entities as View Models - it's just bad karma to do so :)I hope that explains it at least a little bit - it will make more sense as I add more views to the project.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=4661768134975d423174a7506badb1c7&size=50&default=identicon"/>
<p>cowgaR</p></div>
<div class="comment-body">
<br/> 				one of the advantage of NoSQL was that POCO was finaly possible in a simple manner and there wasn't any mapping done (impedance mismatch was almost gone), store whatever you want (no joins, no big-deal about optimal data schema thoughts and so on...).thus developing application became simpler with NoSQL, but I see you're missing itso you're trying over-complicate architecture...and present useless mapping withyour entities-document nonsense...premature optimization is the root of all evil
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				I think you're right - there is a certain element of undoing the good done here - but I also know I'm not alone in doing this because leaving code unguarded from troublesome developers makes people uncomfortable.I'm actually considering going back to quitting this because bugrit, mis-using direct access to modify documents can be prevented through code reviews and education and not_being_lazy.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=4661768134975d423174a7506badb1c7&size=50&default=identicon"/>
<p>cowgaR</p></div>
<div class="comment-body">
<br/> 				what a swift response, thank you - my (angry) point was, seeing you're doing TDD:"how in the hell" did you come to the point you NEED entities in your projectisn't that once I'm doing TDD/BDD, anything I need can be brought later on + refactor?Once we hit some nasty problem that we can't solve?Seeing CQRS mentioned I  thought this will overcomplicate things, although I'm not against the idea of seperating the views/documents as NoSQL fits this nicely...one can't allways assume that there are "bad" developers that screw the code, and we need to "guard" it. That's what tests are for.there are many RubyOnRails application out there which architecture is elegant and simple (even using active record beneath!) and are working fine (twitter front layer is RoR), only we in .NET world aim somewhere to LHC/NASA labs with our code...I like Rob Conery take on this, Web is simple, so should your app be...
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				Ah, you see - I don't need entities in this project, but I already said that :)This is supposed to be a full vertical slice of how you *could* build a proper application (not just a website) on top of RavenDB, but obviously a real application wouldn't be appropriate for a blog series introducing new concepts.I kinda figured that if I did it one way in one set of blog entries, and did it a different way in the upcoming screencasts then people could make their own mind up for their own projects where it makes sense.Clearly this is the wrong choice for a simple little image gallery, but in an enterprise environment (urgh, I hate that phrase) with a complex domain you might wish to do something similar because it keeps the boundaries well defined.I think my personal preference (seeing as the serializer does support it), is to just use read-only properties and have your cake *and* eat it with simplicity AND safety.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				And you're right, most websites and even simple web applications simply don't need those well defined boundaries because it *adds* complexity instead of taking it away.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				And sticking to simple CQRS principles won't be complicating things, that's a separate point from the entities/documents discussion.It just means I have one port of call to get views out, and port of call for enacting change on the model - no fancy architecture/patterns/trickery to be seen here.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				One further thing I forgot to say (Sorry, I think all over the place when I'm writing), unless I had done it this way and started a big discussion in the mailing list and wrote a blog entry summarising that discussion then it wouldn't have taken place and that would be quite sad :)
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=4661768134975d423174a7506badb1c7&size=50&default=identicon"/>
<p>cowgaR</p></div>
<div class="comment-body">
<br/> 				agreed, I've glanced further articles (and discussion, but I started from part 1, gosh! ;-) so continue to bring flame and quality to NoSQL world ;)good job
				</div></div>
</div>
  </body>
</html>
