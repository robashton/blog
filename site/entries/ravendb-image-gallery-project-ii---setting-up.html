<html>
  <head>
    <title id="title">RavenDB-Image Gallery Project (II) - Setting Up</title>
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a class="subscribe" href="http://feeds.feedburner.com/RobAshton">Subscribe to my blog</a>
    <div id="blog-entry">
      <h1 id="post-title">RavenDB-Image Gallery Project (II) - Setting Up</h1>
      <div id="post">
		<p>As with all entries in this series, the up to date code&nbsp; and history can be found in Github at <a href="http://github.com/robashton/RavenGallery/">http://github.com/robashton/RavenGallery/</a></p>  <p><strong>Where do I get RavenDB?</strong></p>  <p>RavenDB can be downloaded from a number of places, you can download the stable binaries, the unstable binaries or go direct to Github and use whatever fork you find there.</p>  <p>I personally run off my own fork which is updated very frequently from Ayende’s code – as it means I can rapidly add any missing features and push them back or fix bugs when I find them.</p>  <p>For this project I’ll be doing just that, and the binaries found in the Image Gallery project will be from my fork found at <a href="http://github.com/robashton/Ravendb">http://github.com/robashton/Ravendb</a></p>  <p>This is because I’ll be utilising functionality that is on the bleeding edge of RavenDB, of course by the time most of you read this they’ll be in the released binaries, so we’ll move to those now.</p>  <p><strong>Released builds (Unstable)</strong></p>  <p>Next up on the stability list are the recent builds, which can be found on the Hibernating Rhinos site <a href="http://builds.hibernatingrhinos.com/builds/RavenDB-Unstable">http://builds.hibernatingrhinos.com/builds/RavenDB-Unstable</a>, this is probably safer than constantly pulling from Ayende’s fork and represent the latest changes that have made it through code review. </p>  <p><strong>Released builds (Commercial)</strong></p>  <p>At time of writing, these are about 20 builds behind the Unstable branch, and as such miss out on some of the functionality that can be enjoyed in the Unstable and code versions of RavenDB. Unless you are planning on releasing software in the next week or two, I don’t really advocate using this branch for development.</p>  <p><strong>Why unstable?</strong></p>  <p>RavenDB is changing constantly, breaking changes still happen, API changes still happen, functionality is being added constantly – I have a suite of tests for all my projects that utilise RavenDB and I test all of my interaction with RavenDB. </p>  <p>By updating regularly I ensure that the amount of work needed to fix any breaking changes is kept to a minimum, as opposed to waiting 30 builds and finding out that half of my entire test suite fails. </p>  <p>That’s not to say that Raven isn’t ready for production because I believe that the stable branch is indeed stable, but because I’m in development and I haven’t got imminent release to look forward to I’m happy to put up with a few bugs in order to get the latest and greatest functionality.</p>  <p><strong>The Project itself</strong></p>  <ul>   <li>I’ve made an MVC2 project in VS2010 and removed all the default garbage that gets provided with it, apart from the JavaScript files, the CSS and the master page. I’m starting from a blank slate and removing all the code because I know how much that offends people. </li>    <li>I’ve downloaded the following libraries: Moq, NUnit, StructureMap and shoved them in a folder called _Libs along with the RavenDB binaries. </li>    <li>Oh yes, I’ve got a basic StructureMapControllerFactory that I’ll be using to create controllers with dependencies injected (in case anybody asks later on) </li>    <li>I’ve got two additional projects (class libraries) which are named RavenGallery.Core and RavenGallery.Core.Tests </li>    <li>I’ve gone through the project settings and ensured their .NET profile is set to .NET Framework 4 </li> </ul>  <p>Here is my solution</p>  <p><a href="http://codeofrob.com/images/codeofrob_com/WindowsLiveWriter/RavenDBImageGalleryProjectIISettingUp_1512C/solution_2.png"><img style="background-image: none; border-right-width: 0px; margin: ;padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px;" title="solution" border="0" alt="solution" src="http://codeofrob.com/images/codeofrob_com/WindowsLiveWriter/RavenDBImageGalleryProjectIISettingUp_1512C/solution_thumb.png" width="301" height="548"></a></p>  <p>And this is what I meant by setting the .NET profile</p>  <p><a href="http://codeofrob.com/images/codeofrob_com/WindowsLiveWriter/RavenDBImageGalleryProjectIISettingUp_1512C/targetframework_2.png"><img style="background-image: none; border-right-width: 0px; margin: ;padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px;" title="targetframework" border="0" alt="targetframework" src="http://codeofrob.com/images/codeofrob_com/WindowsLiveWriter/RavenDBImageGalleryProjectIISettingUp_1512C/targetframework_thumb.png" width="715" height="226"></a></p>  <p>&nbsp;</p>  <p><strong>Which RavenDB Binaries to use?</strong></p>  <p>Once you’ve selected which binary drop to use, you have to make a decision as to which Raven.Client to use, and this is where I tell you why I made sure my Target Framework was set to 4</p>  <ul>   <li>Raven.Client.Lightweight.dll      <ul>       <li>This is for when you are using .NET Framework 4 Client Profile </li>        <li>This doesn’t require any of the other binaries (Lucene/etc) </li>        <li>This doesn’t allow you to host RavenDB within your application </li>        <li>This is therefore a pure client </li>     </ul>   </li>    <li>Raven.Client.3.5.dll      <ul>       <li>As the name suggests, this is for when you are still on the .NET 2.0 runtime (using the .NET 3.5 framework) </li>        <li>This doesn’t require any of the other binaries (Lucene/etc) </li>        <li>This doesn’t allow you to host RavenDB within your application </li>        <li>This is therefore a pure client for older versions of the .NET framework </li>     </ul>   </li>    <li>Raven.Client.Embedded.dll      <ul>       <li>This is the full, heavyweight client for .NET 4.0 (<strong>not client profile!)</strong> </li>        <li>This requires all of the other binaries (Lucene.NET, Esent, etc)&nbsp; - these must <strong>all</strong> be referenced! </li>        <li>This allows you to host RavenDB within your application </li>        <li>This is a mixed client + server </li>     </ul>   </li> </ul>  <p>As my choice of target framework will tell you, I have chosen to host RavenDB internally as part of the web application, and I will take the responsibility for starting up and shutting it down as part of the application lifecycle.</p>  <p>The .NET Framework 4 profile is important, as it is a common gotcha for people to link the wrong binaries and wonder why they are still getting reference errors.</p>  <p>That’s set-up covered, in the next entry I shall cover how we’ll be hosting RavenDB in the application and managing our sessions with it.</p>
	</div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feeds.feedburner.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="inqob_job_postings"></div> 
      <script type="text/javascript" charset="utf-8">
        var __inqob_settings = {
          email_address:  'robashton@codeofrob.com', 
          token:          '',
          debug: false,
          items: [{
            keyword: 'codeofrob', 
            price: 100 
          }]
        };

        (function(is) {
          var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true;
          var src = (document.location.protocol == 'https:' ? 'https://' : 'http://') + 'inqob.com/get/script';
          var q = [];
          q.push('?t='+ new Date().getTime()); 
          q.push('token=' + is.token); 
          q.push('email_address=' + is.email_address); 
          q.push('href=' + encodeURIComponent(window.location.href));
          sc.src = src + q.join('&');
          var s = document.getElementsByTagName('script')[0]; 
          s.parentNode.insertBefore(sc, s);
        })(__inqob_settings);      
      </script>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments"><div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=764e226cad54619d332428e11acaa932&size=50&default=identicon"/>
<p>KevDog</p></div>
<div class="comment-body">
<br/> 				Rob,Extremely glad you're doing this series, some of your early posts on RavenDB were crucial in helping me get going.I don't know what your plans are for the entire series, but the biggest hurdle I am dealing with is adjusting my thinking toward modeling, so if I may be so bold as to ask for a LOT of detail on how you approach your class structure.Again, many thanks for doing this series.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				I'm afraid there is no silver bullet to the problem of modelling, but hopefully the way I am approaching the problem will help with the way you think about the problem.I'll be building the class structure slowly, and going back and modifying the class structure as new requirements and features drive those changes.I aim to make this a good long series with plenty of revisiting and extra functionality/modifications - and feedback such as this will be helpful going forward for what to focus on
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=f1c9122bec3b77b6156b3d8657436fec&size=50&default=identicon"/>
<p>Derek</p></div>
<div class="comment-body">
<br/> 				Good stuff, I was checking out the code.  Cool idea of creating Documents separate from the Model, I didn't think of that.Also, how do your Dynamic queries work as far as stale results?  Before, I was creating a dummy document with my userid so I could make sure it was unique.  I see you're doing that with a dynamic query or with the DoesUserExistWithUsername in the UserService.
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				I'll be covering that later, but essentially dynamic indexes will wait until they either find the number of results or the index is non-stale.That's neither here nor there though, if the results *do* happen to be stale, the worst that can happen is I try to create the user document and it fails by throwing an exception (transaction fails, nothing happens)It's no different to SELECT COUNT(*) FROM users WHERE username = 'whatever';and thenINSERT INTO users { etc }Only to find that the unique constraint on username prevents the transaction from closing
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=b6a6693f03003f7ab0f9b0882e9c2dde&size=50&default=identicon"/>
<p>Rob Ashton</p></div>
<div class="comment-body">
<br/> 				I am not convinced about creating the model around the documents, I'll hold my breath to see how well it works out :)Trying it out rather than saying "this is how it should be", public humiliation followed by change is better than saying nothing at all!
				</div></div>
<div class="comment">
<div class="comment-author">
<img src="http://www.gravatar.com/avatar.php?gravatar_id=f1c9122bec3b77b6156b3d8657436fec&size=50&default=identicon"/>
<p>Derek</p></div>
<div class="comment-body">
<br/> 				It will be interesting to see how it works.  It makes sense I guess, if impedance still exists even if it's a lot less than a relational database.
				</div></div>
</div>
  </body>
</html>
