<html>
  <head>
    <title id="title">The problem with result transformations in RavenDB</title>
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link href='http://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedblitz.com/robashton&x=1" title="Rob Ashton's blog" />
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a class="subscribe" href="http://feed.codeofrob.com/RobAshton">Subscribe to my blog</a>
    <div id="blog-entry">
      <h1 id="post-title">The problem with result transformations in RavenDB</h1>
      <h6>Published on <span class="date">2013-2-20</span></h6>
      <div id="post"><p>I mentioned yesterday that there are some problems with how <a href="/entries/re-thinking-result-transformations-in-ravendb.html">result transformations work in RavenDB</a></p>

<p>In truth, there are no problems, but as <a href="http://twitter.com/ayende">@ayende</a> mentioned himself, feature intersection is causing issues for development in RavenDB.</p>

<p>What is this feature intersection? Well, we have a <em>lot</em> of features around indexes and queries now, and they're all touching and overlapping in all sorts of strange ways - this is hardly surprising, it happens to many well-used software projects with feature requests flying in every day and so many awesome ideas to implement.</p>

<p>The problem that result transformations were initially trying to solve (and I know, I helped implement them in a hotel lobby with Ayende a couple of years ago), were the question of "joins" across documents. Well - this worked well, and had the added bonus of being able to define the exact result shape coming back from RavenDB (pre-forming entire view models in a single query as it were).</p>

<p>That's great, and now we have the ability to do what we did yesterday with yet another feature, load document in map, like so:</p>

<pre><code>    public class Ponies : AbstractIndexCreationTask&lt;Pony&gt;
    {
         public Ponies()
         {
                Map = from pony in ponies
                            let pet = LoadDocument(pony.id)
                            select new {
                                pony.Name,
                                pony.Colour,
                                pony.Trampstamp.
                                PetName = pet.Name.
                                PetSpecies = pet.Species
                            }
         }
    }
</code></pre>

<p>This is kinda cool, although it has implications in complexity when it comes to the indexing and re-indexing of documents that isn't what this blog entry is about.</p>

<p>We've ended up with information in the index which we might want as part of our output, and it's not immediately obvious how we're going to get that out, and this is also doing quite a bit of the work we might want to do with the result transformation phase. (Feature overlap)</p>

<ul>
<li>How about what happens if we have a standard view model that we want to return from a transform, but several different indexes we might query to do that?</li>
<li>What about what happens we want to do a result transform when performing a dynamic query?</li>
<li>And what if we want to use the stored data in index instead of transforming a loaded document?</li>
</ul>

<p>We've actually got a few <em>niggles</em> around these functionalities too, existing as entries in the issue tracker (such as we don't ignore FieldsToFetch when performing a transform), and we've ended up boolean flags to "SkipTransformResults"!!</p>

<p>In essence, it's a bit messy and there is one immediate step we can take to fix this - any takers on what that might be?</p></div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments">

    </div>
  </body>
</html>
