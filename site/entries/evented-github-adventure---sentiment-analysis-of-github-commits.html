<html>
  <head>
    <title id="title">Evented Github Adventure - Sentiment Analysis of Github Commits</title>
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedblitz.com/robashton&x=1" title="Rob Ashton's blog" />
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a class="subscribe" href="http://feed.codeofrob.com/RobAshton">Subscribe to my blog</a>
    <div id="blog-entry">
      <h1 id="post-title">Evented Github Adventure - Sentiment Analysis of Github Commits</h1>
      <h6>Published on <span class="date">2013-5-1</span></h6>
      <div id="post"><p>Okay, back to more practical things now we've covered how easy <a href="/entries/evented-github-adventure---temporal-averages.html">temporal queries are with the event store</a>.</p>

<p>Ever wondered how happy developers from different languages were? Well, let's find out </p>

<p>First off, I downloaded a list of words for both positive and negative sentiment from the internet, here are the references to the studies done which provided these word lists for use:</p>

<pre><code>   Minqing Hu and Bing Liu. "Mining and Summarizing Customer Reviews."
       Proceedings of the ACM SIGKDD International Conference on Knowledge
       Discovery and Data Mining (KDD-2004), Aug 22-25, 2004, Seattle,
       Washington, USA, 
   Bing Liu, Minqing Hu and Junsheng Cheng. "Opinion Observer: Analyzing
       and Comparing Opinions on the Web." Proceedings of the 14th
       International World Wide Web conference (WWW-2005), May 10-14,
       2005, Chiba, Japan.
</code></pre>

<p>So, how to use this? Well, I just pasted the list of words into a file in vim, and ran a macro over them to convert them into two arrays like so:</p>

<pre><code>var happyWords = [ "yay", "funsome", "winsome" ]
var sadWords = [ "boo", "crap", "lame" ]
</code></pre>

<p>There are actually about 5000 words in total, but essentially what I'm going to do is partition by language and keep a count of </p>

<ul>
<li>How many commits per language I see</li>
<li>How many happy words I see in each commit</li>
<li>How many sad words I see in each commit</li>
</ul>

<p>Now, real sentiment analysis is a little more complicated than simply looking for words, but we'll be happy with this for now, let's have a look at the projection:</p>

<pre><code>function collectHappinessIndexOfCommit(commit, state) {
   var index = 0
   for(var i in happyWords) {
       if(commit.message.indexOf(happyWords[i]) &gt;= 0)
          state.happycount++
   }
   for(var i in sadWords) {
       if(commit.message.indexOf(sadWords[i]) &gt;= 0)
          state.sadcount++
   }
   state.commits++
}

fromStreams(['github-commits'])
  .partitionBy(function(ev) {
    if(ev.body.repo)
      return ev.body.repo.language
  })
  .when({
    "$init": function() {
      return { 
         commits: 0, sadcount: 0, happycount: 0
      }
    },
    "Commit": function(state, ev) {
       collectHappinessIndexOfCommit(ev.body.commit, state)
    },
  })
</code></pre>

<p>I guess I'll say that my "happiness index" can be expressed by </p>

<pre><code>var happinessIndex = (state.happycount - state.sadcount) / state.commits
</code></pre>

<p>Or something similar, let's have a look at the chart of happiness over languages</p>

<div id="scaled"></div>

<p>Well, I guess Coffeescript has something going for it after all...</p>

<script type="text/javascript" src="/d3.v2.js"></script>
<script type="text/javascript">

var data = {"JavaScript":{"commits":13336,"sadcount":10362,"happycount":4541},"C":{"commits":6370,"sadcount":9991,"happycount":4669},"Shell":{"commits":2293,"sadcount":1894,"happycount":1002},"Ruby":{"commits":7232,"sadcount":6278,"happycount":2765},"Python":{"commits":8649,"sadcount":8762,"happycount":4081},"null":{"commits":6368,"sadcount":2171,"happycount":1302},"Java":{"commits":11010,"sadcount":10954,"happycount":4749},"R":{"commits":180,"sadcount":101,"happycount":57},"PHP":{"commits":7449,"sadcount":6680,"happycount":3116},"Perl":{"commits":943,"sadcount":941,"happycount":366},"C++":{"commits":4517,"sadcount":5778,"happycount":2702},"C#":{"commits":1773,"sadcount":1570,"happycount":750},"Common Lisp":{"commits":109,"sadcount":129,"happycount":67},"ColdFusion":{"commits":23,"sadcount":13,"happycount":16},"CoffeeScript":{"commits":447,"sadcount":313,"happycount":206},"Emacs Lisp":{"commits":421,"sadcount":378,"happycount":172},"Lua":{"commits":290,"sadcount":217,"happycount":115},"Objective-C":{"commits":1504,"sadcount":1317,"happycount":580},"Verilog":{"commits":21,"sadcount":20,"happycount":13},"Erlang":{"commits":384,"sadcount":427,"happycount":231},"Delphi":{"commits":41,"sadcount":18,"happycount":30},"Haskell":{"commits":389,"sadcount":274,"happycount":182},"ooc":{"commits":6,"sadcount":4,"happycount":5},"VimL":{"commits":854,"sadcount":559,"happycount":255},"FORTRAN":{"commits":56,"sadcount":66,"happycount":55},"ActionScript":{"commits":109,"sadcount":75,"happycount":36},"Assembly":{"commits":23,"sadcount":16,"happycount":7},"Clojure":{"commits":231,"sadcount":281,"happycount":125},"Matlab":{"commits":282,"sadcount":22,"happycount":12},"Scheme":{"commits":25,"sadcount":14,"happycount":13},"Julia":{"commits":109,"sadcount":132,"happycount":68},"Racket":{"commits":68,"sadcount":86,"happycount":35},"Go":{"commits":297,"sadcount":305,"happycount":117},"Scala":{"commits":683,"sadcount":934,"happycount":495},"ASP":{"commits":51,"sadcount":19,"happycount":11},"F#":{"commits":15,"sadcount":9,"happycount":5},"Ada":{"commits":103,"sadcount":68,"happycount":36},"SuperCollider":{"commits":3,"sadcount":1,"happycount":1},"PowerShell":{"commits":18,"sadcount":15,"happycount":7},"Groovy":{"commits":220,"sadcount":191,"happycount":71},"Haxe":{"commits":14,"sadcount":10,"happycount":7},"Kotlin":{"commits":6,"sadcount":11,"happycount":10},"VHDL":{"commits":30,"sadcount":20,"happycount":12},"OpenEdge ABL":{"commits":11,"sadcount":7,"happycount":2},"Rust":{"commits":142,"sadcount":387,"happycount":139},"Puppet":{"commits":147,"sadcount":153,"happycount":60},"AutoHotkey":{"commits":7,"sadcount":2,"happycount":0},"Visual Basic":{"commits":43,"sadcount":24,"happycount":5},"Dart":{"commits":27,"sadcount":18,"happycount":12},"D":{"commits":48,"sadcount":23,"happycount":35},"Arduino":{"commits":63,"sadcount":18,"happycount":15},"Tcl":{"commits":8,"sadcount":7,"happycount":1},"Apex":{"commits":14,"sadcount":18,"happycount":13},"Smalltalk":{"commits":16,"sadcount":11,"happycount":3},"OCaml":{"commits":149,"sadcount":220,"happycount":55},"Coq":{"commits":5,"sadcount":2,"happycount":1},"Standard ML":{"commits":11,"sadcount":8,"happycount":2},"Rebol":{"commits":15,"sadcount":14,"happycount":13},"HaXe":{"commits":12,"sadcount":24,"happycount":5},"Prolog":{"commits":33,"sadcount":40,"happycount":13},"Nemerle":{"commits":5,"sadcount":0,"happycount":0},"Io":{"commits":6,"sadcount":1,"happycount":1},"XQuery":{"commits":17,"sadcount":17,"happycount":10},"Ioke":{"commits":1,"sadcount":0,"happycount":0},"Eiffel":{"commits":23,"sadcount":9,"happycount":9},"Elixir":{"commits":13,"sadcount":23,"happycount":0},"Gosu":{"commits":4,"sadcount":2,"happycount":0},"Vala":{"commits":3,"sadcount":1,"happycount":0},"undefined":{"commits":113,"sadcount":87,"happycount":57},"AppleScript":{"commits":3,"sadcount":0,"happycount":0},"Logtalk":{"commits":6,"sadcount":14,"happycount":6},"Parrot":{"commits":8,"sadcount":2,"happycount":4},"Fantom":{"commits":1,"sadcount":0,"happycount":0},"Lasso":{"commits":24,"sadcount":11,"happycount":7},"TypeScript":{"commits":23,"sadcount":30,"happycount":7},"LiveScript":{"commits":1,"sadcount":2,"happycount":2},"XML":{"commits":8,"sadcount":8,"happycount":10},"Factor":{"commits":4,"sadcount":6,"happycount":4},"Objective-J":{"commits":20,"sadcount":44,"happycount":22}}
</script>

<script type="text/javascript">

   var filteredData = []
   for(var i in data) {
     if(i === 'null') continue
     if(data[i].commits >= 200) {
       var datum = {
        key: i,
        state: data[i]
       }
       datum.state.index = (datum.state.happycount / datum.state.sadcount) 
       filteredData.push(datum)
     }
   }

  var svg = d3.select("#scaled").append("svg")
          .attr("width", 800)
          .attr("height", 480)

   var scale = d3.scale.linear()
     .domain([d3.min(filteredData, function(d) { return d.state.index}), d3.max(filteredData, function(d) { return d.state.index })])
     .range([0, 1]);

   var max = d3.max(filteredData, function(d) { return d.state.index });

   svg.append("text")
      .attr("fill", '#000')
      .attr("x", 110)
      .attr("y", 60)
      .text("Happiness index of github commit analysis")

   svg.selectAll(".label")
      .data(filteredData)
      .enter()
        .append("text")
        .attr("class", "label")
        .attr("transform", function(d, i) { 
          var transform = "translate(" + i * (640 / filteredData.length) + "," + 380 + ") "
          transform += "rotate(75) "
          return transform
        })
        .attr("x", 0)
        .attr("y", 0)
        .text(function(d) { return d.key })

    svg.selectAll(".time")
     .data(filteredData)
     .enter()
       .append("rect")
         .attr("class", "time")
         .attr("fill", '#AAF')
         .attr("x", function(d, i) { return i * (640 / filteredData.length)})
         .attr("y", function(d, i) { return 370 - (280 * scale(d.state.index)) })
         .attr("width", 640 / (filteredData.length + 1))
         .attr("height", function(d, i) { return 280 * scale(d.state.index) })
</script></div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="inqob_job_postings"></div> 
      <script type="text/javascript" charset="utf-8">
        var __inqob_settings = {
          email_address:  'robashton@codeofrob.com', 
          token:          '',
          debug: false,
          items: [{
            keyword: 'codeofrob', 
            price: 100 
          }]
        };

        (function(is) {
          var sc = document.createElement('script'); sc.type = 'text/javascript'; sc.async = true;
          var src = (document.location.protocol == 'https:' ? 'https://' : 'http://') + 'inqob.com/get/script';
          var q = [];
          q.push('?t='+ new Date().getTime()); 
          q.push('token=' + is.token); 
          q.push('email_address=' + is.email_address); 
          q.push('href=' + encodeURIComponent(window.location.href));
          sc.src = src + q.join('&');
          var s = document.getElementsByTagName('script')[0]; 
          s.parentNode.insertBefore(sc, s);
        })(__inqob_settings);      
      </script>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments">

    </div>
  </body>
</html>
