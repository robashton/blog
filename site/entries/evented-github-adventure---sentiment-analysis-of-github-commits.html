<html>
  <head>
    <title id="title">Evented Github Adventure - Sentiment Analysis of Github Commits</title>
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link href='http://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedblitz.com/robashton&x=1" title="Rob Ashton's blog" />
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body>
    <a class="subscribe" href="http://feed.codeofrob.com/RobAshton">Subscribe to my blog</a>
    <div id="blog-entry">
      <h1 id="post-title">Evented Github Adventure - Sentiment Analysis of Github Commits</h1>
      <h6>Published on <span class="date">2013-5-15</span></h6>
      <div id="post"><p>Carrying on in the EventStore series...</p>

<ul>
<li><a href="/entries/playing-with-the-eventstore.html">Introduction to the EventStore</a></li>
<li><a href="/entries/pushing-data-into-streams-in-the-eventstore.html">Pushing data into the EventStore</a></li>
<li><a href="/entries/basic-projections-in-the-eventstore.html">Projections in the EventStore</a></li>
<li><a href="/entries/re-partitioning-streams-in-the-event-store-for-better-projections.html">Re-partitioning streams in the EventStore</a></li>
<li><a href="/entries/creating-a-projection-per-stream-in-the-eventstore.html">Creating a projection per stream</a></li>
<li><a href="/entries/less-abstract,-pumping-data-from-github-into-the-eventstore.html">Pumping data from Github into the EventStore</a></li>
<li><a href="/entries/evented-github-adventure---emitting-commits-as-their-own-events.html">Emitting new events from a projection</a></li>
<li><a href="/entries/evented-github-adventure---who-writes-the-sweariest-commit-messages.html">Who is the sweariest of them all?</a></li>
<li><a href="/entries/evented-github-adventure---temporal-queries,-who-doesnt-trust-their-hardware.html">Temporal queries in the event store</a></li>
<li><a href="/entries/evented-github-adventure---crossing-the-streams-to-gain-real-insights.html">Projections from multiple streams</a></li>
<li><a href="/entries/evented-github-adventure---temporal-averages.html">Temporal averages</a></li>
<li>Sentiment analysis of Github events</li>
</ul>

<p>Okay, back to more practical things now we've covered how easy <a href="/entries/evented-github-adventure---temporal-averages.html">temporal queries are with the event store</a>.</p>

<p>Ever wondered how happy developers from different languages were? Well, let's find out </p>

<p>First off, I downloaded a list of words for both positive and negative sentiment from the internet, here are the references to the studies done which provided these word lists for use:</p>

<pre><code>   Minqing Hu and Bing Liu. "Mining and Summarizing Customer Reviews."
       Proceedings of the ACM SIGKDD International Conference on Knowledge
       Discovery and Data Mining (KDD-2004), Aug 22-25, 2004, Seattle,
       Washington, USA, 
   Bing Liu, Minqing Hu and Junsheng Cheng. "Opinion Observer: Analyzing
       and Comparing Opinions on the Web." Proceedings of the 14th
       International World Wide Web conference (WWW-2005), May 10-14,
       2005, Chiba, Japan.
</code></pre>

<p>So, how to use this? Well, I just pasted the list of words into a file in vim, and ran a macro over them to convert them into two arrays like so:</p>

<pre><code>var happyWords = [ "yay", "funsome", "winsome" ]
var sadWords = [ "boo", "crap", "lame" ]
</code></pre>

<p>There are actually about 5000 words in total, but essentially what I'm going to do is partition by language and keep a count of </p>

<ul>
<li>How many commits per language I see</li>
<li>How many happy words I see in each commit</li>
<li>How many sad words I see in each commit</li>
</ul>

<p>Now, real sentiment analysis is a little more complicated than simply looking for words, but we'll be happy with this for now, let's have a look at the projection:</p>

<pre><code>function collectHappinessIndexOfCommit(commit, state) {
   var index = 0
   for(var i in happyWords) {
       if(commit.message.indexOf(happyWords[i]) &gt;= 0)
          state.happycount++
   }
   for(var i in sadWords) {
       if(commit.message.indexOf(sadWords[i]) &gt;= 0)
          state.sadcount++
   }
   state.commits++
}

fromStreams(['github-commits'])
  .partitionBy(function(ev) {
    if(ev.body.repo)
      return ev.body.repo.language
  })
  .when({
    "$init": function() {
      return { 
         commits: 0, sadcount: 0, happycount: 0
      }
    },
    "Commit": function(state, ev) {
       collectHappinessIndexOfCommit(ev.body.commit, state)
    },
  })
</code></pre>

<p>I guess I'll say that my "happiness index" can be expressed by </p>

<pre><code>var index = happycount / sadcount
</code></pre>

<p>Or something similar (not the point of this post, if you want to change it then modify the JS on this page..), let's have a look at the chart of happiness over languages</p>

<div id="scaled"></div>

<p>The Haskell/Lisp guys are happy because they don't need to ship anything? ;-) I'll let you all draw your own conclusions here...</p>

<p><em>Note: The differences are actually hilariously small, and although there is a huge amount of data it is likely not statistically that relevant, this is just a bit of fun</em></p>

<script type="text/javascript" src="/d3.v2.js"></script>
<script type="text/javascript">

var data = 

{"Lua":{"commits":1471,"happycount":568,"sadcount":1164},"Java":{"commits":57652,"happycount":26112,"sadcount":59956},"C":{"commits":31898,"happycount":25670,"sadcount":53669},"AutoHotkey":{"commits":49,"happycount":16,"sadcount":51},"null":{"commits":35613,"happycount":7819,"sadcount":14434},"C++":{"commits":25296,"happycount":14834,"sadcount":33367},"Ruby":{"commits":42890,"happycount":17496,"sadcount":38583},"undefined":{"commits":611,"happycount":231,"sadcount":495},"Python":{"commits":41811,"happycount":19433,"sadcount":43012},"JavaScript":{"commits":78254,"happycount":29268,"sadcount":62612},"PHP":{"commits":34239,"happycount":13593,"sadcount":30559},"Emacs Lisp":{"commits":2116,"happycount":977,"sadcount":1867},"Objective-C":{"commits":6925,"happycount":2962,"sadcount":5894},"Shell":{"commits":12370,"happycount":5196,"sadcount":10808},"Erlang":{"commits":1376,"happycount":662,"sadcount":1606},"ColdFusion":{"commits":293,"happycount":109,"sadcount":250},"CoffeeScript":{"commits":3018,"happycount":1098,"sadcount":2593},"C#":{"commits":8977,"happycount":3818,"sadcount":8683},"Groovy":{"commits":1022,"happycount":404,"sadcount":912},"Go":{"commits":1617,"happycount":820,"sadcount":1582},"Rust":{"commits":1058,"happycount":588,"sadcount":1845},"Arduino":{"commits":342,"happycount":150,"sadcount":229},"Standard ML":{"commits":66,"happycount":16,"sadcount":32},"R":{"commits":1165,"happycount":510,"sadcount":891},"Perl":{"commits":4940,"happycount":2639,"sadcount":5417},"Haskell":{"commits":2066,"happycount":849,"sadcount":1589},"Common Lisp":{"commits":419,"happycount":275,"sadcount":518},"Verilog":{"commits":236,"happycount":130,"sadcount":193},"Haxe":{"commits":112,"happycount":58,"sadcount":116},"ooc":{"commits":36,"happycount":8,"sadcount":20},"VimL":{"commits":4494,"happycount":1302,"sadcount":3222},"Scala":{"commits":3249,"happycount":1869,"sadcount":3719},"Clojure":{"commits":1628,"happycount":800,"sadcount":1437},"FORTRAN":{"commits":173,"happycount":115,"sadcount":169},"ActionScript":{"commits":852,"happycount":321,"sadcount":703},"Assembly":{"commits":305,"happycount":151,"sadcount":237},"OCaml":{"commits":574,"happycount":276,"sadcount":598},"ASP":{"commits":303,"happycount":86,"sadcount":146},"Puppet":{"commits":1072,"happycount":397,"sadcount":1112},"OpenEdge ABL":{"commits":86,"happycount":21,"sadcount":64},"HaXe":{"commits":183,"happycount":60,"sadcount":227},"Julia":{"commits":512,"happycount":316,"sadcount":456},"D":{"commits":294,"happycount":131,"sadcount":247},"Tcl":{"commits":184,"happycount":105,"sadcount":219},"Visual Basic":{"commits":278,"happycount":76,"sadcount":223},"Racket":{"commits":415,"happycount":198,"sadcount":468},"Delphi":{"commits":260,"happycount":160,"sadcount":150},"Matlab":{"commits":1152,"happycount":210,"sadcount":366},"Dart":{"commits":299,"happycount":104,"sadcount":234},"Coq":{"commits":56,"happycount":18,"sadcount":28},"Vala":{"commits":39,"happycount":25,"sadcount":61},"Gosu":{"commits":4,"happycount":0,"sadcount":1},"F#":{"commits":228,"happycount":110,"sadcount":272},"Logtalk":{"commits":16,"happycount":15,"sadcount":34},"Scheme":{"commits":219,"happycount":91,"sadcount":125},"Prolog":{"commits":238,"happycount":94,"sadcount":229},"Augeas":{"commits":1,"happycount":1,"sadcount":3},"PowerShell":{"commits":206,"happycount":63,"sadcount":193},"VHDL":{"commits":176,"happycount":70,"sadcount":160},"Turing":{"commits":3,"happycount":3,"sadcount":3},"DCPU-16 ASM":{"commits":23,"happycount":11,"sadcount":7},"Smalltalk":{"commits":175,"happycount":113,"sadcount":164},"XQuery":{"commits":38,"happycount":10,"sadcount":45},"Dylan":{"commits":17,"happycount":9,"sadcount":20},"Objective-J":{"commits":85,"happycount":65,"sadcount":157},"Factor":{"commits":172,"happycount":132,"sadcount":142},"Ada":{"commits":74,"happycount":23,"sadcount":52},"Kotlin":{"commits":11,"happycount":11,"sadcount":7},"Rebol":{"commits":25,"happycount":16,"sadcount":22},"Io":{"commits":10,"happycount":0,"sadcount":6},"Nemerle":{"commits":7,"happycount":5,"sadcount":2},"Elixir":{"commits":57,"happycount":35,"sadcount":57},"Eiffel":{"commits":16,"happycount":12,"sadcount":24},"Boo":{"commits":6,"happycount":2,"sadcount":0},"SuperCollider":{"commits":15,"happycount":12,"sadcount":29},"AppleScript":{"commits":15,"happycount":11,"sadcount":23},"Parrot":{"commits":33,"happycount":16,"sadcount":50},"Scilab":{"commits":13,"happycount":5,"sadcount":12},"Apex":{"commits":25,"happycount":7,"sadcount":25},"Ceylon":{"commits":42,"happycount":11,"sadcount":14},"Bro":{"commits":3,"happycount":2,"sadcount":1},"Pure Data":{"commits":19,"happycount":7,"sadcount":12},"Max":{"commits":1,"happycount":0,"sadcount":0},"Fancy":{"commits":4,"happycount":0,"sadcount":2},"Lasso":{"commits":605,"happycount":225,"sadcount":615},"TypeScript":{"commits":245,"happycount":75,"sadcount":219},"XML":{"commits":176,"happycount":43,"sadcount":162},"LiveScript":{"commits":10,"happycount":5,"sadcount":15},"Awk":{"commits":4,"happycount":1,"sadcount":2},"Mirah":{"commits":4,"happycount":0,"sadcount":0},"Xtend":{"commits":2,"happycount":0,"sadcount":0},"Ioke":{"commits":2,"happycount":0,"sadcount":0},"Monkey":{"commits":5,"happycount":0,"sadcount":0},"Logos":{"commits":66,"happycount":34,"sadcount":49},"eC":{"commits":1,"happycount":0,"sadcount":0},"Nimrod":{"commits":2,"happycount":0,"sadcount":3},"CLIPS":{"commits":3,"happycount":1,"sadcount":3},"Arc":{"commits":1,"happycount":2,"sadcount":3}}
</script>

<script type="text/javascript">

   var filteredData = []
   for(var i in data) {
     if(i === 'null') continue
     if(i === 'undefined') continue
     if(data[i].commits >= 2000) {
       var datum = {
        key: i,
        state: data[i]
       }

       var happytotal = datum.state.happycount// / datum.state.commits
        , sadtotal = datum.state.sadcount// / datum.state.commits

       datum.state.index = (happytotal / sadtotal) 
       filteredData.push(datum)
     }
   }

  if(filteredData.sort)
    filteredData = filteredData.sort(function(a,b) { return a.state.index - b.state.index })

  var svg = d3.select("#scaled").append("svg")
          .attr("width", 800)
          .attr("height", 480)


   var max = d3.max(filteredData, function(d) { return d.state.index })
    , min = d3.min(filteredData, function(d) { return d.state.index })


   var scale = d3.scale.linear()
     .domain([min, max])
     .range([0, 1]);


   svg.append("text")
      .attr("fill", '#000')
      .attr("x", 110)
      .attr("y", 60)
      .text("Happiness index of github commit analysis")

   svg.selectAll(".label")
      .data(filteredData)
      .enter()
        .append("text")
        .attr("class", "label")
        .attr("transform", function(d, i) { 
          var transform = "translate(" + i * (640 / filteredData.length) + "," + 380 + ") "
          transform += "rotate(75) "
          return transform
        })
        .attr("x", 0)
        .attr("y", 0)
        .text(function(d) { return d.key })

    svg.selectAll(".time")
     .data(filteredData)
     .enter()
       .append("rect")
         .attr("class", "time")
         .attr("fill", '#AAF')
         .attr("x", function(d, i) { return i * (640 / filteredData.length)})
         .attr("y", function(d, i) { return 370 - (280 * scale(d.state.index)) })
         .attr("width", 640 / (filteredData.length + 1))
         .attr("height", function(d, i) { return 280 * scale(d.state.index) })
</script></div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments">

    </div>
  </body>
</html>
