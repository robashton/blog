<!doctype html> <!--[if ie 7]> <html lang="en" class="ie7"> <![endif]-->
<!--[if ie 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if ie 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !ie]><!-->
<html lang="en"> <!--<![endif]-->
<head>
    <title id="title">Evented Github Adventure - Crossing the streams to gain real insights</title>
    <meta charset="utf-8">
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <meta name="author" content="">
    <link rel="alternate" type="application/atom+xml" href="http://feed.codeofrob.com/RobAshton" title="Rob Ashton's blog" />
    <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/headers/header1.css">
    <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/assets/css/style_responsive.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/themes/default.css">
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/rainbow.css"></link>
    <script type="text/javascript" src="/assets/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div class="header">
        <div class="container">
            <div class="logo">
             <h2><a href="/index.html">Rob Ashton</a></h2>
            </div>
            <div class="navbar">
                <div class="navbar-inner">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                    </a>
                    <div class="nav-collapse collapse">
                        <ul class="nav top-2">
                          <li>
                                <a href="/">Home</a>
                            </li>
                            <li>
                                <a href="/blog.html">Blog</a>
                            </li>
                            <li>
                                <a href="/statements.html">Testimonials</a>
                            </li>
                            <li>
                                <a href="/hire.html">Hire Me</a>
                            </li>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <body>
    <div id="blog-entry">
      <h1 id="post-title">Evented Github Adventure - Crossing the streams to gain real insights</h1>
      <h6>Published on <span class="date">2013-5-13</span></h6>
      <div id="post"><p>Carrying on in the EventStore series...</p>
<ul>
<li><a href="/entries/playing-with-the-eventstore.html">Introduction to the EventStore</a></li>
<li><a href="/entries/pushing-data-into-streams-in-the-eventstore.html">Pushing data into the EventStore</a></li>
<li><a href="/entries/basic-projections-in-the-eventstore.html">Projections in the EventStore</a></li>
<li><a href="/entries/re-partitioning-streams-in-the-event-store-for-better-projections.html">Re-partitioning streams in the EventStore</a></li>
<li><a href="/entries/creating-a-projection-per-stream-in-the-eventstore.html">Creating a projection per stream</a></li>
<li><a href="/entries/less-abstract,-pumping-data-from-github-into-the-eventstore.html">Pumping data from Github into the EventStore</a></li>
<li><a href="/entries/evented-github-adventure---emitting-commits-as-their-own-events.html">Emitting new events from a projection</a></li>
<li><a href="/entries/evented-github-adventure---who-writes-the-sweariest-commit-messages.html">Who is the sweariest of them all?</a></li>
<li><a href="/entries/evented-github-adventure---temporal-queries,-who-doesnt-trust-their-hardware.html">Temporal queries in the event store</a></li>
<li>Projections from multiple streams</li>
</ul>
<p>It&#39;s not enough to just create a <a href="/entries/evented-github-adventure---temporal-queries,-who-doesnt-trust-their-hardware.html">stream of &#39;events&#39; from correlated actions over time</a>, although that <em>is</em> super cool, what we want to do is then use that stream to tell us something interesting about the activity of developers on Github.</p>
<p>Like, given that we have this information about paranoid pushes, how do they stack up as a percentage to pushes overall when broken down by language?</p>
<p><em>Problem</em>: This information is in completely different streams.</p>
<p>Not to worry, this is where the Event Store&#39;s ability to re-partition and consume streams in a variety of ways comes to the rescue once more, want to consume the events from two different streams? Not a problem</p>
<pre><code><span class="function"><span class="title">fromStreams</span><span class="params">([ <span class="string">"github"</span>, <span class="string">"paranoidpushes"</span> ])</span>
   .<span class="title">when</span><span class="params">(<span class="tuple">{

   }</span>)</span>
</code></pre><p>First off, let&#39;s keep it simple and just find out as a percentage what the paranoid pushes are out of the overal Github stream.</p>
<pre><code><span class="function"><span class="title">fromStreams</span><span class="params">([ <span class="string">"github"</span>, <span class="string">"paranoidpushes"</span> ])</span>
   .<span class="title">when</span><span class="params">(<span class="tuple">{
     <span class="string">"$init"</span>: <span class="keyword">fun</span><span class="function_name">ction</span>() <span class="tuple">{
       return <span class="tuple">{ paranoid: <span class="number">0</span>, total: <span class="number">0</span> }</span>
     }</span>,
     <span class="string">"ParanoidPush"</span>: <span class="keyword">fun</span><span class="function_name">ction</span>(state, ev) <span class="tuple">{
       state.paranoid++
     }</span>,
     <span class="string">"PushEvent"</span>: <span class="keyword">fun</span><span class="function_name">ction</span>(state, ev) <span class="tuple">{
       state.total++
     }</span>
   })
</code></pre><p>So yeah, er - that was stupidly easy, I didn&#39;t even have to think about that one, we just get all the events from those streams as a unified collection and were able to generate stats from these.</p>
<p>What does the result look like?</p>
<pre><code>{"<span class="attribute">paranoid</span>":<span class="value"><span class="number">181423</span></span>,"<span class="attribute">total</span>": <span class="value"><span class="number">2272796</span>}</span>
</code></pre><p>So, in fact around 8% of all pushes to Github happen within 2 minutes of the previous one - that&#39;s actually quite high - and my guess is that these are either people rectifying mistakes in previous commits (actually, there&#39;s an idea for another projection) or people who are new to git.</p>
<p>Let&#39;s generate a result object by language and see what we get</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">getPerLanguageState</span><span class="params">(state, ev)</span> {</span>
  <span class="keyword">var</span> language = getLanguageFromEvent(ev)
  <span class="keyword">var</span> langState = state[language]
  <span class="keyword">if</span>(!langState) {
    langState = { paranoid: <span class="number">0</span>, total: <span class="number">0</span> }
    state[language] = langState
  }
  <span class="keyword">return</span> langState
}

<span class="function"><span class="keyword">function</span> <span class="title">getLanguageFromEvent</span><span class="params">(ev)</span> {</span>
  <span class="keyword">if</span>(ev.body.repo)
    <span class="keyword">return</span> ev.body.repo.language
  <span class="keyword">if</span>(ev.body.first)
    <span class="keyword">return</span> ev.body.first.body.repo.language
}

fromStreams([ <span class="string">"github"</span>, <span class="string">"paranoidpushes"</span> ])
  .when({
   <span class="string">"$init"</span>: <span class="keyword">function</span>() {
     <span class="keyword">return</span> {}
   },
   <span class="string">"ParanoidPush"</span>: <span class="keyword">function</span>(state, ev) {
     <span class="keyword">var</span> langState = getPerLanguageState(state, ev)
     langState.paranoid++
     <span class="keyword">return</span> state
   },
   <span class="string">"PushEvent"</span>: <span class="keyword">function</span>(state, ev) {
     <span class="keyword">var</span> langState = getPerLanguageState(state, ev)
     langState.total++
     <span class="keyword">return</span> state
   }
  })
</code></pre><p>There is a lot to take in here, but we can see</p>
<ul>
<li>I can use custom functions in my projection definition to break down the work</li>
<li>The custom functions simply work out what language my event is</li>
<li>The custom functions return a per-language state object</li>
<li>The projection just adds to the values in that per-language state object</li>
</ul>
<p>Anyway, the results of this?</p>
<div id="notscaled"></div>

<p>And scaled</p>
<div id="scaled"></div>


<p>So the old school Java and C++ developers can&#39;t get enough of that push-based action,  with nearly 16% of their pushes happening within a couple of minutes of their previous push.</p>
<p>Matlab too (presumably they&#39;re not doing CI to heroku), maybe they&#39;re just worried about their university computer sessions crashing or something.</p>
<p>Not terribly interesting results, but a good example of when it makes sense to combine two streams from the EventStore together.</p>
<script type="text/javascript" src="/d3.v2.js"></script>
<script type="text/javascript">


var data = 
{"Lua":{"paranoid":710,"total":9208},"Java":{"paranoid":34212,"total":298219},"C":{"paranoid":12549,"total":121676},"AutoHotkey":{"paranoid":14,"total":278},"null":{"paranoid":35773,"total":258170},"C++":{"paranoid":21271,"total":133376},"Ruby":{"paranoid":17924,"total":227354},"undefined":{"paranoid":0,"total":4858},"Python":{"paranoid":17700,"total":205053},"JavaScript":{"paranoid":45154,"total":454877},"PHP":{"paranoid":16789,"total":187223},"Emacs Lisp":{"paranoid":828,"total":11998},"Objective-C":{"paranoid":2715,"total":36117},"Shell":{"paranoid":6792,"total":69272},"Erlang":{"paranoid":541,"total":5643},"ColdFusion":{"paranoid":156,"total":1253},"CoffeeScript":{"paranoid":1489,"total":16010},"C#":{"paranoid":3597,"total":48749},"Groovy":{"paranoid":433,"total":5500},"Go":{"paranoid":868,"total":10820},"Rust":{"paranoid":253,"total":1944},"Arduino":{"paranoid":198,"total":2353},"Standard ML":{"paranoid":819,"total":3191},"R":{"paranoid":522,"total":7247},"Perl":{"paranoid":2069,"total":25325},"Haskell":{"paranoid":719,"total":10351},"Common Lisp":{"paranoid":151,"total":2120},"Verilog":{"paranoid":95,"total":1337},"Haxe":{"paranoid":103,"total":1220},"ooc":{"paranoid":11,"total":193},"VimL":{"paranoid":1625,"total":25894},"FORTRAN":{"paranoid":104,"total":1355},"Scala":{"paranoid":1070,"total":14685},"Clojure":{"paranoid":737,"total":8938},"ActionScript":{"paranoid":365,"total":4431},"Assembly":{"paranoid":170,"total":1755},"OCaml":{"paranoid":189,"total":2563},"ASP":{"paranoid":176,"total":2160},"Puppet":{"paranoid":536,"total":5874},"OpenEdge ABL":{"paranoid":31,"total":319},"HaXe":{"paranoid":24,"total":401},"Julia":{"paranoid":110,"total":1677},"D":{"paranoid":112,"total":1778},"Tcl":{"paranoid":59,"total":502},"Visual Basic":{"paranoid":137,"total":1893},"Racket":{"paranoid":112,"total":1552},"Delphi":{"paranoid":93,"total":1578},"Matlab":{"paranoid":1393,"total":8684},"Dart":{"paranoid":199,"total":2435},"Coq":{"paranoid":32,"total":556},"Vala":{"paranoid":55,"total":435},"Gosu":{"paranoid":5,"total":88},"F#":{"paranoid":86,"total":1186},"Logtalk":{"paranoid":3,"total":73},"Scheme":{"paranoid":162,"total":2117},"Prolog":{"paranoid":82,"total":1117},"Augeas":{"paranoid":1,"total":22},"PowerShell":{"paranoid":98,"total":1366},"VHDL":{"paranoid":56,"total":874},"Turing":{"paranoid":5,"total":28},"DCPU-16 ASM":{"paranoid":1,"total":59},"Smalltalk":{"paranoid":48,"total":490},"XQuery":{"paranoid":6,"total":142},"Dylan":{"paranoid":4,"total":103},"Objective-J":{"paranoid":11,"total":215},"Factor":{"paranoid":40,"total":504},"Ada":{"paranoid":40,"total":326},"Kotlin":{"paranoid":7,"total":129},"Rebol":{"paranoid":2,"total":45},"Io":{"paranoid":5,"total":83},"Nemerle":{"paranoid":40,"total":168},"Elixir":{"paranoid":29,"total":354},"Eiffel":{"paranoid":37,"total":463},"Boo":{"paranoid":3,"total":62},"SuperCollider":{"paranoid":14,"total":260},"AppleScript":{"paranoid":24,"total":176},"Parrot":{"paranoid":4,"total":75},"Scilab":{"paranoid":7,"total":93},"Apex":{"paranoid":14,"total":236},"Ceylon":{"paranoid":2,"total":45},"Bro":{"paranoid":1,"total":8},"Pure Data":{"paranoid":17,"total":149},"Max":{"paranoid":0,"total":1},"Fancy":{"paranoid":2,"total":5},"Lasso":{"paranoid":72,"total":641},"TypeScript":{"paranoid":164,"total":2189},"XML":{"paranoid":220,"total":2649},"LiveScript":{"paranoid":23,"total":288},"Awk":{"paranoid":13,"total":110},"Mirah":{"paranoid":0,"total":4},"Xtend":{"paranoid":4,"total":62},"Ioke":{"paranoid":1,"total":12},"Monkey":{"paranoid":3,"total":41},"Logos":{"paranoid":197,"total":2704},"eC":{"paranoid":0,"total":6},"Nimrod":{"paranoid":5,"total":75},"CLIPS":{"paranoid":1,"total":43},"Arc":{"paranoid":5,"total":22},"DOT":{"paranoid":39,"total":727},"Rouge":{"paranoid":0,"total":3},"Ecl":{"paranoid":0,"total":20},"Processing":{"paranoid":157,"total":1528},"Nu":{"paranoid":15,"total":73},"Forth":{"paranoid":0,"total":9},"PogoScript":{"paranoid":1,"total":18},"Pike":{"paranoid":0,"total":13},"TXL":{"paranoid":0,"total":1},"Fantom":{"paranoid":0,"total":21},"MoonScript":{"paranoid":3,"total":50},"Ragel in Ruby Host":{"paranoid":2,"total":22},"Opa":{"paranoid":0,"total":3},"ABAP":{"paranoid":0,"total":1}}

   var filteredData = []
   for(var i in data) {
     if(data[i].total >= 5000) {
       var datum = data[i]
       datum.state = {
        paranoid: data[i].paranoid,
        total: data[i].total,
        percentage: Math.floor((data[i].paranoid / data[i].total) * 10000) / 100
       }
       datum.key = i
       filteredData.push(datum)
     }
   }
</script>

<script type="text/javascript">

  var svg = d3.select("#notscaled").append("svg")
          .attr("width", 640)
          .attr("height", 480)


   var scale = d3.scale.linear()
     .domain([0, d3.max(filteredData, function(d) { return d.state.total })])
     .range([0, 280]);

   svg.selectAll("text")
      .data(filteredData)
      .enter()
        .append("text")
        .attr("transform", function(d, i) { 
          var transform = "translate(" + i * (640 / filteredData.length) + "," + 380 + ") "
          transform += "rotate(75) "
          return transform
        })
        .attr("x", 0)
        .attr("y", 0)
        .text(function(d) { return d.key })

   svg.selectAll(".total")
     .data(filteredData)
     .enter()
       .append("rect")
         .attr("class", "total")
         .attr("fill", '#00A')
         .attr("x", function(d, i) { return i * (640 / filteredData.length)})
         .attr("y", function(d, i) { return 370 - scale(d.state.total); })
         .attr("width", 640 / (filteredData.length + 1))
         .attr("height", function(d, i) { return scale(d.state.total) })

    svg.selectAll(".paranoid")
     .data(filteredData)
     .enter()
       .append("rect")
         .attr("class", "paranoid")
         .attr("fill", '#AAF')
         .attr("x", function(d, i) { return i * (640 / filteredData.length)})
         .attr("y", function(d, i) { return 370 - scale(d.state.paranoid); })
         .attr("width", 640 / (filteredData.length + 1))
         .attr("height", function(d, i) { return scale(d.state.paranoid) })

</script>

<script type="text/javascript">

  var svg = d3.select("#scaled").append("svg")
          .attr("width", 800)
          .attr("height", 480)

   var scale = d3.scale.linear()
     .domain([0, d3.max(filteredData, function(d) { return d.state.percentage })])
     .range([0, 1]);

   var maxPercentage = d3.max(filteredData, function(d) { return d.state.percentage });

   svg.append("text")
      .attr("fill", '#000')
      .attr("x", 710)
      .attr("y", 60)
      .text(maxPercentage + "%")

   svg.append("text")
      .attr("fill", '#000')
      .attr("x", 710)
      .attr("y", 350)
      .text(0 + "%")

   svg.selectAll(".label")
      .data(filteredData)
      .enter()
        .append("text")
        .attr("class", "label")
        .attr("transform", function(d, i) { 
          var transform = "translate(" + i * (640 / filteredData.length) + "," + 380 + ") "
          transform += "rotate(75) "
          return transform
        })
        .attr("x", 0)
        .attr("y", 0)
        .text(function(d) { return d.key })

    svg.selectAll(".paranoid")
     .data(filteredData)
     .enter()
       .append("rect")
         .attr("class", "paranoid")
         .attr("fill", '#AAF')
         .attr("x", function(d, i) { return i * (640 / filteredData.length)})
         .attr("y", function(d, i) { return 370 - (280 * scale(d.state.percentage)) })
         .attr("width", 640 / (filteredData.length + 1))
         .attr("height", function(d, i) { return 280 * scale(d.state.percentage) })
</script>

</div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="hire-me">
        <h6>This used to be a call to action on contacting me</h6>
        <p>But I'm really not interested in being contacted and probably won't even read the comments on this article</p>
        <p>I'm working hard at a company and any blog entries I might write are because I had some spare time and felt like sharing :-)</p>
      </div>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments">

    </div>

<div class="footer" style="margin-top: 0px">
    <div class="container">
        <div class="row-fluid">
            <div class="span3">
                <div class="headline"><h3>Get In Touch</h3></div>
                <address class="address">
                    <ul class="icons-ul">
                        <li><i class="icon-li icon-envelope"></i>Email: <a href="mailto:robashton@codeofrob.com" class="">robashton@codeofrob.com</a></li>
                        <li><i class="icon-li icon-envelope"></i>Skype: <a href="skype:rob_ashton" class="">rob_ashton</a></li>
                    </ul>
                </address>
            </div><!--/span3-->
            <div class="span5">
                <div class="headline"><h3>Subscribe</h3></div>
                <p>I publish an <a href="http://feed.codeofrob.com/RobAshton">RSS feed</a> from my blog and some other activities</p>
            </div>
            <div class="span4">
                <div class="posts">
                  <div class="headline"><h3>Find me...</h3></div>
                  <p><a href="http://twitter.com/robashton"><img src="/assets/img/twitter.jpg" alt="" />
                  <a href="http://github.com/robashton"><img src="/assets/img/github.png" alt="" /></a></p>
                </div>
            </div><!--/span4-->
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/footer-->
<!--=== End Footer ===-->

<!--=== Copyright ===-->
<div class="copyright">
    <div class="container">
        <div class="row-fluid">
            <div class="span2">
              <a href="/">Rob Ashton</a>
            </div>
            <div class="span6">
              <p class="terms">2014 Â© Rob Ashton. ALL Rights Reserved.</p>
            </div>
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/copyright-->
<!--=== End Copyright ===-->

<!-- JS Global Compulsory -->
<script type="text/javascript" src="/assets/js/modernizr.custom.js"></script>
<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<!-- JS Implementing Plugins -->
<script type="text/javascript" src="/assets/plugins/flexslider/jquery.flexslider-min.js"></script>
<script type="text/javascript" src="/assets/plugins/parallax-slider/js/modernizr.js"></script>
<script type="text/javascript" src="/assets/plugins/parallax-slider/js/jquery.cslider.js"></script>
<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
<script type="text/javascript" src="/assets/plugins/jquery.sticky.js"></script>
<script type="text/javascript" src="/assets/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
<!-- JS Page Level -->
<script type="text/javascript" src="/assets/js/app.js"></script>
<script type="text/javascript" src="/assets/js/pages/index.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function() {
      	App.init();
        App.initFancybox();
        App.initSliders();
        Index.initParallaxSlider();
    });
</script>
<!--[if lt IE 9]>
    <script src="assets/js/respond.js"></script>
<![endif]-->
  </body>
</html>

