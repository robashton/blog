<!doctype html> <!--[if ie 7]> <html lang="en" class="ie7"> <![endif]-->  
<!--[if ie 8]> <html lang="en" class="ie8"> <![endif]-->  
<!--[if ie 9]> <html lang="en" class="ie9"> <![endif]-->  
<!--[if !ie]><!--> 
<html lang="en"> <!--<![endif]-->  
<head>
    <title id="title">Learn Functional Programming With Me - Moving The Square</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/style.css"></link>
    <link rel="stylesheet" type="text/css" href="/rainbow.css"></link>
    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="Description" content="Rob Ashton's blog and various other things. Javascript, C#, testing, whatever.">
    <meta name="author" content="">
    <link rel="alternate" type="application/atom+xml" href="http://feed.codeofrob.com/RobAshton" title="Rob Ashton's blog" />
    <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/headers/header1.css">
    <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="/assets/css/style_responsive.css">
    <link rel="shortcut icon" href="/favicon.ico">        
    <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/themes/default.css">
    <script type="text/javascript" src="/assets/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-11207442-1']);
      _gaq.push(['_setDomainName', 'codeofrob.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body>
    <div class="header">               
        <div class="container"> 
            <div class="logo">                                             
             <h2><a href="/index.html">Rob Ashton</a></h2>
            </div>
            <div class="navbar">                                
                <div class="navbar-inner">                                  
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                      <span class="icon-bar"></span>
                    </a>
                    <div class="nav-collapse collapse">                                     
                        <ul class="nav top-2">
                          <li>
                                <a href="/">Home</a>
                            </li>
                            <li>
                                <a href="/blog.html">Blog</a>
                            </li>
                            <li>
                                <a href="/statements.html">Testimonials</a>
                            </li>
                            <li>
                                <a href="/hire.html">Hire Me</a>
                            </li>
                    </div>
                </div>
            </div>
        </div>
    </div>

  <body>
    <div id="blog-entry">
      <h1 id="post-title">Learn Functional Programming With Me - Moving The Square</h1>
      <h6>Published on <span class="date">2012-6-13</span></h6>
      <div id="post"><p>So, last session I managed to get a square being drawn, as if I haven&#39;t done that a thousand times in JS - now to do something a bit more dangerous (because it involves state), and more likely to get me in trouble - let&#39;s move the square around using the keyboard.</p>
<p><strong>Reminder</strong>: The source for all of this can be found at <a href="https://github.com/robashton/clojure-spaceinvaders">github.com/robashton/clojure-spaceinvaders</a></p>
<h2>Parameterising the function</h2>
<p>This is a no-brainer, I&#39;m going to need to know where to draw this thing, I start off by passing in the state required to draw a rect to my function.</p>
<pre><code><span class="list">(<span class="title">defn</span><span class="body"> drawRect [x y w h]
  <span class="list">(<span class="title">let</span><span class="body"> [target <span class="list">(<span class="body">.getElementById js/document <span class="string">"target"</span>)</span></span>
        context <span class="list">(<span class="body">.getContext target <span class="string">"2d"</span>)</span></span>]
     <span class="list">(<span class="body">.fillRect context x y w h)</span></span>           
  )</span></span>
)</span></span></code></pre>
<p>So far so good - but now I&#39;m going to need to not only pass in those variables, but - well they&#39;re going to have to be variable (somehow) because they&#39;re going to have to change each frame and it&#39;s stuff like this that makes me break out in a cold sweat because I haven&#39;t discovered the patterns to solve this type of problem yet.</p>
<p>Let&#39;s explain - you see that &#39;let&#39; statement, the values I&#39;ve defined there, those key value pairs are <em>immutable</em>, this means I cannot change them - for example, if I want to make this square move of its own voilition, the literal equivalent of</p>
<pre><code><span class="function"><span class="title">for</span><span class="params">(var x = <span class="number">0</span>; x &lt; <span class="number">1000</span>; x++)</span>
  <span class="title">drawRect</span><span class="params">(x, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>)</span>;</code></pre>
<p>Doesn&#39;t exist.</p>
<p>Now, if I were to make my best guess at how to solve this, I&#39;d say that we need a function that takes in x, and then calls itself with x+1, for example at a conceptual level:</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">drawAndMove</span><span class="params">(x)</span> <span class="comment">{
  drawRect(x, 0, 100, 100)
  if(x &lt;= 1000)
    drawAndMove(x+1)
}</span>
<span class="title">drawAndMove</span><span class="params">(0)</span>;</span></code></pre>
<p>This actually maps across to a construct in our chosen world that looks something like the following:</p>
<pre><code><span class="list">(<span class="title">loop</span><span class="body"> [x <span class="number">0</span>]
  <span class="list">(<span class="title">drawRect</span><span class="body"> x <span class="number">0</span> <span class="number">100</span> <span class="number">100</span>)</span></span>     
  <span class="list">(<span class="title">if</span><span class="body"> <span class="list">(<span class="title">&lt;=</span><span class="body"> x <span class="number">1000</span>)</span></span>
    <span class="list">(<span class="title">recur</span><span class="body"> <span class="list">(<span class="title">inc</span><span class="body"> x)</span></span>)</span></span>
  )</span></span>
)</span></span></code></pre>
<ul>
<li>I want to loop, I want the following values available in this loop (x = 0)</li>
<li>Please draw the rect at x,0,100,100</li>
<li>If x &lt;= 1000, recurse and increment x</li>
</ul>
<p>Okay, this is a bit crazy and verbose - perhaps there is a better more shorthand way of doing this (anybody care to chip in around now?), but Imma press ahead and say that actually, that is not the greatest loop of all time.</p>
<p>We actually have to yield to the UI thread each &#39;frame&#39; which blows this whole thing out of the water - that&#39;s not to say that this code isn&#39;t functional - because I love having a row of black drawn over my canvas on the UI thread with no user interaction whatsoever - but we actually need something like the following</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">tick</span><span class="params">()</span> {</span>
  logic();
  render();
  setTimeout(tick, <span class="number">33</span>);
}</code></pre>
<p>Again, cutting a corner here because I don&#39;t want to write a full on game loop in clojure just yet.</p>
<p>Figuring it out, I&#39;ve ended up with something like this</p>
<pre><code><span class="list">(<span class="title">defn</span><span class="body"> tick [x]
  <span class="list">(<span class="title">drawRect</span><span class="body"> x <span class="number">0</span> <span class="number">100</span> <span class="number">100</span>)</span></span>
  <span class="list">(<span class="title">if</span><span class="body"> <span class="list">(<span class="title">&lt;=</span><span class="body"> x <span class="number">1000</span>)</span></span>
    <span class="list">(<span class="title">js/setTimeout</span><span class="body"> <span class="list">(<span class="title">fn</span><span class="body"> []
       <span class="list">(<span class="title">tick</span><span class="body"> <span class="list">(<span class="title">inc</span><span class="body"> x)</span></span>)</span></span>
    )</span></span> <span class="number">33</span>  )</span></span>
  )</span></span>
)</span></span>


<span class="list">(<span class="title">defn</span><span class="body"> ^<span class="keyword">:export</span> init []
   <span class="list">(<span class="title">tick</span><span class="body"> <span class="number">0</span>)</span></span>
)</span></span></code></pre>
<ul>
<li>Define a function called tick, which takes in the current position of our object</li>
<li>Draw a rect at that location</li>
<li>If x is still less than 1000, then</li>
<li>In 33 milliseconds, call tick again but with x+1</li>
</ul>
<p>I&#39;ve actually gone far enough for a single blog entry at this point so I&#39;ll leave keyboard input till another day - I have some thoughts about this work so far however:</p>
<ul>
<li>That setTimeout doo-hick is taking in an anonymous function, am I creating this function every frame? I wouldn&#39;t do that in most of my JS, it&#39;s effectively the same as creating a closure in a loop - not good?</li>
<li>I saw something like this that used global state and an atom, and then tick could be called with no parameters - is this a better solution? It seems somewhat against what functional programming is about</li>
<li>Thoughts?</li>
</ul>
</div>
      <div id="links">
        <a href="/">Index</a>
        <a href="http://feed.codeofrob.com/RobAshton">Subscribe</a>
        <a href="http://twitter.com/robashton">Follow me</a>
      </div>
      <div id="hire-me">
        <h6>Why not hire me?</h6>
        <p>I am available for emergency consults, workshops, training and short-term development work anywhere in Europe</p>
        <p>C#, JavaScript, Clojure, RavenDB, NodeJS, Architecture review.. etc</p>
        <p><a href="mailto:robashton@codeofrob.com">Get in touch</a></p>
      </div>
      <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codeofrob'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div id="post-comments">

    </div>

<div class="footer" style="margin-top: 0px">
    <div class="container">
        <div class="row-fluid">
            <div class="span3">
                <div class="headline"><h3>Get In Touch</h3></div>
                <address class="address">
                    <ul class="icons-ul">
                        <li><i class="icon-li icon-envelope"></i>Email: <a href="mailto:robashton@codeofrob.com" class="">robashton@codeofrob.com</a></li>
                        <li><i class="icon-li icon-envelope"></i>Skype: <a href="skype:rob_ashton" class="">rob_ashton</a></li>
                    </ul>
                </address>
            </div><!--/span3-->
            <div class="span5">
                <div class="headline"><h3>Subscribe</h3></div>
                <p>I publish an <a href="http://feed.codeofrob.com/RobAshton">RSS feed</a> from my blog and some other activities</p>
            </div>
            <div class="span4">
                <div class="posts">
                  <div class="headline"><h3>Find me...</h3></div>
                  <p><a href="http://twitter.com/robashton"><img src="/assets/img/twitter.jpg" alt="" />
                  <a href="http://github.com/robashton"><img src="/assets/img/github.png" alt="" /></a></p>
                </div>
            </div><!--/span4-->
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/footer-->
<!--=== End Footer ===-->

<!--=== Copyright ===-->
<div class="copyright">
    <div class="container">
        <div class="row-fluid">
            <div class="span2">
              <a href="/">Rob Ashton</a>
            </div>
            <div class="span6">
              <p class="terms">2013 Â© Rob Ashton. ALL Rights Reserved.</p>
            </div>
        </div><!--/row-fluid-->
    </div><!--/container-->
</div><!--/copyright-->
<!--=== End Copyright ===-->

<!-- JS Global Compulsory -->			
<script type="text/javascript" src="/assets/js/modernizr.custom.js"></script>		
<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>	
<!-- JS Implementing Plugins -->           
<script type="text/javascript" src="/assets/plugins/flexslider/jquery.flexslider-min.js"></script>
<script type="text/javascript" src="/assets/plugins/parallax-slider/js/modernizr.js"></script>
<script type="text/javascript" src="/assets/plugins/parallax-slider/js/jquery.cslider.js"></script>
<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
<script type="text/javascript" src="/assets/plugins/jquery.sticky.js"></script>
<script type="text/javascript" src="/assets/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
<!-- JS Page Level -->           
<script type="text/javascript" src="/assets/js/app.js"></script>
<script type="text/javascript" src="/assets/js/pages/index.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function() {
      	App.init();
        App.initFancybox();
        App.initSliders();
        Index.initParallaxSlider();
    });
</script>
<!--[if lt IE 9]>
    <script src="assets/js/respond.js"></script>
<![endif]-->
  </body>
</html>

